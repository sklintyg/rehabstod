<div ng-if="patientAgViewState.getAgTableVisible()">

  <h3>Intyg till arbetsgivaren</h3>

  <div class="rhs-ag-table-container">

    <h4>Intyg till arbetsgivaren för patienten på {{getEffectiveVardenhetUnitName()}} - räknas inte in i patientens uppskattade position i rehabiliteringskedjan.</h4>

    <div ng-if="agItems.intyg.length === 0 && !agItems.error" class="no-ag-items">
      <span>Patienten har inga intyg till arbetsgivaren på {{getEffectiveVardenhetUnitName()}}.</span>
    </div>

    <div ng-if="agItems.error" class="alert alert-danger">
      <span message key="server.error.loadpatientag.text"></span>
    </div>


  <div ng-if="agItems.intyg.length > 0 && !agItems.error" class="patient-ag-table-container">

      <div data-ng-if="filteredColumns.length === 0" class="alert alert-warning no-columns">
        När du tidigare anpassade tabellen valde du bort samtliga kolumner och kan därför inte se den nu. För att lägga till kolumner igen,&nbsp;<rhs-patient-table-select-columns label-key="label.table.custom.modal.link"></rhs-patient-table-select-columns>.
      </div>

      <div class="table-responsive" data-ng-if="filteredColumns.length > 0">
        <table id="patient-ag-table" class="table table-striped">
          <thead>
          <tr>
            <th data-ng-repeat="column in filteredColumns" class="{{::column.classes}}">
              {{::'label.patient.table.column.' + column.id | message}}
            </th>
            <th id="header-column-show-intyg" class="column-showintyg">&nbsp;</th>
           </tr>
          </thead>

          <tbody>
          <!--
          <tr ng-if="agItems.intyg.length === 0 || agItems.error">
            <td style="width:calc(100% - 130px);background-color:#efefef; overflow: auto;position:absolute ; top: auto">
              <span style="padding-top: 10px" ng-if="agItems.intyg.length === 0 && !agItems.error" message key="label.patienthistory.ag.table.empty"></span>
              <span class="alert" ng-if="agItems.error" message key="server.error.loadpatientag.text"></span>
            </td>
            <td></td>
          </tr>
          -->
          <tr ng-if="agItems.intyg.length > 0 && !agItems.error" ng-repeat="(rowIndex, intyg) in agItems.intyg">

            <td data-ng-repeat="column in filteredColumns"
                ng-attr-id="intyg-{{index}}-column-{{::column.id}}-{{::rowIndex}}">
              <div data-ng-if="column.id === 'number'">{{rowIndex + 1}}</div>
              <div data-ng-if="column.id === 'intyg'">AG7777</div>
              <div data-ng-if="column.id === 'diagnose'" class="nowrap column-diagnos">
                <div class="diagnos-container">
              <span uib-tooltip-html="getToolTip(intyg.diagnos)" tooltip-popup-delay="200"
                    class="patient-ag-dialog-tooltip" tooltip-placement="top-left">{{::intyg.diagnos.intygsVarde}}
              </span><span ng-if="!intyg.diagnos.intygsVarde" class="hidden-value">Okänt</span>
                  <div class="diagnos hidden-xs hidden-sm">{{::intyg.diagnos.beskrivning}}</div>
                </div>
                <div class="diagnos-container" ng-repeat="d in intyg.bidiagnoser">
                  <span uib-tooltip-html="getToolTip(d)" tooltip-popup-delay="200" tooltip-placement="auto top-right" class="patient-ag-dialog-tooltip">{{::d.intygsVarde}}</span>
                  <span class="diagnos hidden-xs hidden-sm">{{::d.beskrivning}}</span>
                </div>
              </div>
              <div data-ng-if="column.id === 'startdate'" class="nowrap">{{::intyg.start}}</div>
              <div data-ng-if="column.id === 'enddate'" class="nowrap">{{::intyg.slut}}</div>
              <div data-ng-if="column.id === 'length'">{{::intyg.dagar}} dagar</div>
              <div data-ng-if="column.id === 'grade'" class="nowrap">
                <span ng-bind-html="::formatGrader(intyg.grader)"></span><span ng-if="!intyg.grader || intyg.grader.length <= 0" class="hidden-value">Okänt</span>
              </div>
              <div data-ng-if="column.id === 'doctor'">{{::intyg.lakare.namn}}<span ng-if="!intyg.lakare.namn" class="hidden-value">Okänt</span></div>
              <div data-ng-if="column.id === 'occupation'">
                <div ng-repeat="s in intyg.sysselsattning track by $index">{{::s}}</div>
                <span ng-if="!intyg.sysselsattning || intyg.sysselsattning.length <= 0" class="hidden-value">Okänt</span>
              </div>
              <div data-ng-if="column.id === 'vardenhet'">{{::intyg.vardenhetNamn}}</div>
              <div data-ng-if="column.id === 'vardgivare'">{{::intyg.vardgivareNamn}}</div>
            </td>

            <td class="column-showintyg">
              <button class="btn btn-default" ng-attr-id="sjukfall-{{index}}-show-intyg-{{intyg.id}}"
                      ng-click="onLoadIntyg({'intyg': intyg})"><b><i class="glyphicon glyphicon-eye-open"></i> Visa intyg</b>
              </button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <div class="space-column-showintyg">
      </div>

    </div>

  </div>
  <h3>Intyg till försäkringskassan</h3>
</div>
<!--</div>-->

<div ng-if="!patientAgViewState.getAgTableVisible()"><br></div>